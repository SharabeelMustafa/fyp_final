<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="stylesheet" href="Style/panal_style.css">
  <title>Demo 2</title>

  <style>
    .info-card {
      margin-top: 10px;
      background-color: #f8f9fa;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .info-card h4 {
      color: #007bff;
      text-align: center;
    }

    .info-item {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .info-label {
      font-weight: bold;
      color: #343a40;
      flex: 0 0 150px;
    }

    .info-value {
      color: #495057;
    }

    .driver-img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-right: 15px;
    }

    .contact-btn {
      display: block;
      width: 100%;
      margin-top: 15px;
      padding: 10px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <!-- Bars -->
  <div class="container-fluid p-0" id="some-menu"></div>

  
  <input type="hidden" id="getalertMessage" value="<%= alertMessage || '' %>" />


  <div class="page-wrapper px-3">
    <div class="container-fluid rounded-2 px-0">
      <div class="d-flex justify-content-between bg-color rounded-3 p-3 gap-2 card-shadow">
        <div class="py-3">
          <% let fullString=currentDate.toString(); %>
            <% let desiredPart=fullString.substring(0, 21); %>
              <p class="small text-black my-5">
                <%= desiredPart %>
              </p>
              <h2 class="mb-0 text-black">Welcome, <%= student.name %>!</h2>
              <p class="mb-0 text-black">Always stay updated in your Bus portal</p>
        </div>
        <div class="me-2">

          <img src="uploads/<%=student.profile_img %>" class="r-img" alt="" width="200px" height="200px" />
        </div>
      </div>

      <!-- Route Information Section -->
      <div class="row">
        <div class="info-card mx-5 my-4 px-5 col-5 rounded-3 p-4 bg-color card-shadow">
          <h4 class="text-center text-primary mb-3">Your Bus Route Information</h4>

          <!-- Driver Information -->
          <div class="info-item mb-3 d-flex align-items-center gap-3">
            <!-- Placeholder for Driver Image -->
            <img src="./assets/images/busImage.png" alt="" width="246px" height="189px " />

            <div>
              <div class="info-label fw-bold">Route Name:</div>
              <div class="info-value">
                <%=route.route_name %>
              </div>

              <div class="info-label fw-bold">Bus NO:</div>
              <div class="info-value">
                <%=bus.bus_id %>
              </div>
            </div>
          </div>

          <!-- Student Pickup Information -->
          <div class="d-flex">
            <div class="info-item mb-3">
              <span class="info-label fw-bold">Pickup Time:</span>
              <span class="info-value">
                <%=stop.pickup_time %>
              </span>
            </div>
            <div style="margin-left: 100px;">
              <button id="route-chage" class="btn btn-primary btn-blue ">Apply for Route Change</button>
            </div>
          </div>
          <!-- Student Stop Information -->
          <div class="info-item mb-3">
            <span class="info-label fw-bold">Pickup Stop:</span>
            <span class="info-value">
              <%=stop.stop_name %>
            </span>
          </div>



        </div>
        <div class="info-card px-5 mx-5 my-4 col-5 rounded-3 p-4 bg-color card-shadow">
          <h4 class="text-center text-primary mb-3">Your Bus Driver Information</h4>



          <!-- Driver Information -->
          <div class="info-item mb-3 d-flex align-items-center gap-3">
            <!-- Placeholder for Driver Image -->
            <img src="uploads/<%=driver.profile_img %>" class="" alt="Driver Image" width="180px" height="200px " />

            <div>
              <div class="info-label fw-bold">Driver Name:</div>
              <div class="info-value">
                <%=driver.name%>
              </div>

              <div class="info-label fw-bold">Driver Phone:</div>
              <div class="info-value">
                <%=driver.contact %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- applay for route chage  Overlay -->
    <div class="overlay" id="signup-overlay">
      <div class="overlay-content">
        <button class="close-btn" id="close-signup">&times;</button>
        <div class="text-center">
          <img src="./assets/images/logo1.png" width="150px" height="150px" alt="">
          <h2 class="mb-0">Apply for Route change </h2>
          <!-- <p class="small">Already have an account? <span><a href="#" id="hide-signup" class="text-danger">Sign-in here</a></span></p> -->
        </div>
        <form action="/rouChangeApplication" method="post">
          <div class="row">
            <div class="col-6">
              <div class="mb-3">
                <label for="" class="form-label regular small"> Old </label>
                <label for="routeSelect" class="form-label regular small">Route Name</label>
                <label   class="form-control">
                    
                      <%=route.route_name %>
                     
                </label>
              </div>
            </div>
            <div class="col-6">
              <div class="mb-3">
                <label for="" class="form-label regular small"> Select</label>
                <label for="routeSelect" class="form-label regular small">New Route</label>
                <select name="route" id="routeSelect" class="form-control">
                  <% allRoutes.forEach(r=> { %>
                    <option value="<%= r.r_id %>">
                      <%= r.route_name %>
                    </option>
                    <% }); %>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              <div class="mb-3">
                <label for="" class="form-label regular small">Old</label>
                <label for="routeSelect" class="form-label regular small">stop Name</label>
                <label   class="form-control">
                  
                    
                      <%=stop.stop_name %>
                    
                   
                </label>
              </div>
            </div>
            <div class="col-6">
              <div class="mb-3">
                <label for="" class="form-label regular small">Select New Stop</label>
                <select name="stop" id="stopSelect" class="form-control">
                  <% allstop.forEach(s=> { %>
                    <option value="<%= s.s_id %>" data-rid="<%= s.r_id %>">
                      <%= s.stop_name %>
                    </option>
                    <% }); %>
                </select>
              </div>
            </div>
          </div>

          <input type="hidden"  name="newrouteName"   >
          <input type="hidden"  name="oldrouteName"  value="<%=route.route_name %>" >
          <input type="hidden"  name="old_route"  value="<%=route.r_id %>" >
          <input type="hidden"  name="newStopName"    >
          <input type="hidden"  name="oldStopName"  value="<%=stop.stop_name %>"  >
          <input type="hidden"  name="old_stop"  value="<%=stop.s_id %>"  >

            <div class="d-flex justify-content-evenly align-items-center pt-5 mt-3">
              <button type="submit" class="btn btn-danger px-5 w-75 text-black btn-blue "> Apply</button>
              <!-- <a href="/challan" ></a> -->
            </div>
          
        
        </form>
      </div>
    </div>

    
     
    
    <script>

          const alertMessage = document.getElementById("getalertMessage").value;

          // If the value is not empty, show the alert
          if (alertMessage) {
            alert(alertMessage);
          }

      // Function to update hidden input values based on the selected options
      function updateHiddenInputs() {
        const routeSelect = document.getElementById('routeSelect');
        const stopSelect = document.getElementById('stopSelect');
        const routeNameInput = document.querySelector('input[name="newrouteName"]');
        const stopNameInput = document.querySelector('input[name="newStopName"]');
    
        // Get the selected option's text
        const selectedRouteOption = routeSelect.options[routeSelect.selectedIndex];
        const selectedStopOption = stopSelect.options[stopSelect.selectedIndex];
    
        // Update hidden input values
        routeNameInput.value = selectedRouteOption ? selectedRouteOption.text : '';
        stopNameInput.value = selectedStopOption ? selectedStopOption.text : '';
      }
    
      // Add event listeners for changes in the select elements
      document.getElementById('routeSelect').addEventListener('change', updateHiddenInputs);
      document.getElementById('stopSelect').addEventListener('change', updateHiddenInputs);
    
      // Initialize the hidden inputs on page load
      document.addEventListener('DOMContentLoaded', updateHiddenInputs);
  
      // Hide the signup overlay initially
      document.getElementById('signup-overlay').style.display = 'none';

      document.getElementById('close-signup').addEventListener('click', function () {
        document.getElementById('signup-overlay').style.display = 'none';
      });
      // Add event listener for the route change button
      document.getElementById('route-chage').addEventListener('click', function () {
        document.getElementById('signup-overlay').style.display = 'flex';
      });


      document.getElementById('routeSelect').addEventListener('change', function () {
        const selectedRoute = this.value;
        const stopSelect = document.getElementById('stopSelect');
        const options = stopSelect.querySelectorAll('option');

        options.forEach(option => {
          if (option.getAttribute('data-rid') === selectedRoute) {
            option.style.display = 'block';
          } else {
            option.style.display = 'none';
          }
        });

        // Optionally, reset the stop selection if the current selection is hidden
        if (stopSelect.value && stopSelect.querySelector(`option[value="${stopSelect.value}"]`).style.display === 'none') {
          stopSelect.value = '';
        }
      });

      // Trigger change event on page load to filter stops based on the initial route selection
      document.getElementById('routeSelect').dispatchEvent(new Event('change'));

    </script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="assets/js/jquery-3.6.3.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/moment.min.js"></script>
    <script src="assets/js/Toggels.js"></script>
    <script>
      $("#some-menu").load("navbars_stu.ejs");
    </script>

    <!--     
      <footer class="mxc">
        <div class="mtc rounded-3 p-1 gap-2 bg-color">
          <h5 class="text-black">CUI Bus Portal</h5>
        </div>
      </footer> -->
</body>

</html>